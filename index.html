<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Quiz Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        h2 {
            margin: 20px 0 10px 0;
            color: #555;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .lobby {
            text-align: center;
        }

        .team-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            transition: background 0.3s;
        }

        button:hover {
            background: #0056b3;
        }

        button.left-btn {
            background: #ff6b6b;
        }

        button.left-btn:hover {
            background: #cc5555;
        }

        button.right-btn {
            background: #4ecdc4;
        }

        button.right-btn:hover {
            background: #3fa39c;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: Arial, sans-serif;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .score-box {
            display: flex;
            gap: 30px;
            margin: 30px 0;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
        }

        .team-score {
            padding: 20px;
            border-radius: 5px;
            text-align: center;
            min-width: 200px;
        }

        .left-score {
            background: #ffcccc;
            color: #cc0000;
        }

        .right-score {
            background: #ccf5f2;
            color: #008080;
        }

        .round-info {
            text-align: center;
            font-size: 16px;
            margin: 20px 0;
            color: #666;
        }

        .question-box {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            border: 2px solid #ddd;
        }

        .answer-box {
            background: #fffacd;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            border: 2px solid #ffeb3b;
        }

        .grading-box {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            border: 2px solid #4caf50;
        }

        .finish-box {
            text-align: center;
            font-size: 24px;
            color: #333;
            margin: 30px 0;
        }

        .winner {
            color: #ff6b00;
            font-weight: bold;
            font-size: 32px;
        }

        .grade-input {
            width: 100px;
            font-size: 18px;
            text-align: center;
        }

        .members-list {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .members-list p {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Team Quiz Game</h1>

        <!-- LOBBY SECTION -->
        <div id="lobby" class="section active">
            <div class="lobby">
                <h2>Join a Team</h2>
                <p style="margin-bottom: 20px; color: #666;">Enter your name and choose a team</p>

                <input type="text" id="playerName" placeholder="Enter your name" maxlength="30">

                <div class="team-buttons">
                    <button class="left-btn" onclick="joinTeam('left')">Join Left Team</button>
                    <button class="right-btn" onclick="joinTeam('right')">Join Right Team</button>
                </div>

                <div class="score-box">
                    <div class="team-score left-score">
                        <div>Left Team</div>
                        <div id="lobby-left-members" style="font-size: 12px; margin-top: 10px;">0 members</div>
                    </div>
                    <div class="team-score right-score">
                        <div>Right Team</div>
                        <div id="lobby-right-members" style="font-size: 12px; margin-top: 10px;">0 members</div>
                    </div>
                </div>

                <button id="startBtn" onclick="startGame()" disabled style="width: 100%; padding: 15px; font-size: 18px;">Start Game (need at least 1 player per team)</button>
            </div>
        </div>

        <!-- GAME SECTION -->
        <div id="gameSection" class="section">
            <div class="score-box">
                <div class="team-score left-score">
                    Left Team: <span id="left-score">0</span>/25
                </div>
                <div class="team-score right-score">
                    Right Team: <span id="right-score">0</span>/25
                </div>
            </div>

            <div class="round-info">
                Round: <span id="currentRound">1</span>/5
            </div>

            <!-- LEFT ASKS PHASE -->
            <div id="left-asks" class="section">
                <h2>üî¥ Left Team - Ask a Question</h2>
                <div class="info-box">
                    Left Team asks a question, Right Team answers and Left Team grades (0-5 points)
                </div>
                <textarea id="question-input" placeholder="Enter your question here..."></textarea>
                <button onclick="submitQuestion()" style="width: 100%;">Submit Question</button>
            </div>

            <!-- RIGHT ANSWERS PHASE -->
            <div id="right-answers" class="section">
                <h2>üîµ Right Team - Answer the Question</h2>
                <div class="question-box">
                    <strong>Question from Left Team:</strong>
                    <p id="display-question-1" style="margin-top: 10px; font-size: 16px;"></p>
                </div>
                <textarea id="answer-input" placeholder="Enter your answer here..."></textarea>
                <button onclick="submitAnswer()" style="width: 100%;">Submit Answer</button>
            </div>

            <!-- RIGHT ANSWERS GRADING PHASE -->
            <div id="right-answers-grading" class="section">
                <h2>üî¥ Left Team - Grade the Answer</h2>
                <div class="question-box">
                    <strong>Question:</strong>
                    <p id="display-question-2" style="margin-top: 10px; font-size: 16px;"></p>
                </div>
                <div class="answer-box">
                    <strong>Answer from Right Team:</strong>
                    <p id="display-answer-1" style="margin-top: 10px; font-size: 16px;"></p>
                </div>
                <div class="grading-box">
                    <label for="grade-input-1">Give a score (0-5):</label>
                    <input type="number" id="grade-input-1" class="grade-input" min="0" max="5" value="0">
                    <button onclick="submitGrade()" style="width: 100%; margin-top: 10px;">Submit Grade</button>
                </div>
            </div>

            <!-- RIGHT ASKS PHASE -->
            <div id="right-asks" class="section">
                <h2>üîµ Right Team - Ask a Question</h2>
                <div class="info-box">
                    Right Team asks a question, Left Team answers and Right Team grades (0-5 points)
                </div>
                <textarea id="question-input-2" placeholder="Enter your question here..."></textarea>
                <button onclick="submitQuestion()" style="width: 100%;">Submit Question</button>
            </div>

            <!-- LEFT ANSWERS PHASE -->
            <div id="left-answers" class="section">
                <h2>üî¥ Left Team - Answer the Question</h2>
                <div class="question-box">
                    <strong>Question from Right Team:</strong>
                    <p id="display-question-3" style="margin-top: 10px; font-size: 16px;"></p>
                </div>
                <textarea id="answer-input-2" placeholder="Enter your answer here..."></textarea>
                <button onclick="submitAnswer()" style="width: 100%;">Submit Answer</button>
            </div>

            <!-- LEFT ANSWERS GRADING PHASE -->
            <div id="left-answers-grading" class="section">
                <h2>üîµ Right Team - Grade the Answer</h2>
                <div class="question-box">
                    <strong>Question:</strong>
                    <p id="display-question-4" style="margin-top: 10px; font-size: 16px;"></p>
                </div>
                <div class="answer-box">
                    <strong>Answer from Left Team:</strong>
                    <p id="display-answer-2" style="margin-top: 10px; font-size: 16px;"></p>
                </div>
                <div class="grading-box">
                    <label for="grade-input-2">Give a score (0-5):</label>
                    <input type="number" id="grade-input-2" class="grade-input" min="0" max="5" value="0">
                    <button onclick="submitGrade()" style="width: 100%; margin-top: 10px;">Submit Grade</button>
                </div>
            </div>
        </div>

        <!-- FINISHED SECTION -->
        <div id="finished" class="section">
            <div class="finish-box">
                <h2>Game Over!</h2>
                <div style="margin: 30px 0;">
                    <div class="team-score left-score" style="margin: 20px 0;">
                        Left Team: <span id="final-left-score">0</span>/25 points
                    </div>
                    <div class="team-score right-score" style="margin: 20px 0;">
                        Right Team: <span id="final-right-score">0</span>/25 points
                    </div>
                </div>
                <div id="winner-announcement" style="margin: 30px 0;"></div>
                <button onclick="resetGame()" style="width: 100%; padding: 15px; font-size: 18px;">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        let gameState = null;
        let currentTeam = null;
        let pollInterval = null;

        // Poll game state
        async function pollState() {
            const response = await fetch('/api/state');
            gameState = await response.json();
            updateUI();
        }

        function updateUI() {
            // Update scores in lobby
            document.getElementById('lobby-left-members').textContent = gameState.leftTeam.members.length + ' members';
            document.getElementById('lobby-right-members').textContent = gameState.rightTeam.members.length + ' members';

            // Enable start button if both teams have at least 1 player
            const canStart = gameState.leftTeam.members.length > 0 && gameState.rightTeam.members.length > 0;
            document.getElementById('startBtn').disabled = !canStart;

            // Update game UI
            if (gameState.gamePhase !== 'lobby') {
                document.getElementById('lobby').classList.remove('active');
                document.getElementById('gameSection').classList.add('active');
                document.getElementById('finished').classList.remove('active');

                // Update scores
                document.getElementById('left-score').textContent = gameState.leftTeam.score;
                document.getElementById('right-score').textContent = gameState.rightTeam.score;
                document.getElementById('currentRound').textContent = gameState.round;

                // Show current phase
                document.querySelectorAll('#gameSection > div').forEach(el => {
                    el.classList.remove('active');
                });

                const phaseMap = {
                    'left-asks': 'left-asks',
                    'right-answers': 'right-answers',
                    'right-answers-grading': 'right-answers-grading',
                    'right-asks': 'right-asks',
                    'left-answers': 'left-answers',
                    'left-answers-grading': 'left-answers-grading'
                };

                if (phaseMap[gameState.gamePhase]) {
                    document.getElementById(phaseMap[gameState.gamePhase]).classList.add('active');

                    // Display questions and answers
                    if (gameState.leftTeam.currentQuestion) {
                        document.getElementById('display-question-1').textContent = gameState.leftTeam.currentQuestion;
                        document.getElementById('display-question-2').textContent = gameState.leftTeam.currentQuestion;
                    }
                    if (gameState.rightTeam.currentQuestion) {
                        document.getElementById('display-question-3').textContent = gameState.rightTeam.currentQuestion;
                        document.getElementById('display-question-4').textContent = gameState.rightTeam.currentQuestion;
                    }
                    if (gameState.currentAnswer) {
                        document.getElementById('display-answer-1').textContent = gameState.currentAnswer;
                        document.getElementById('display-answer-2').textContent = gameState.currentAnswer;
                    }
                }
            } else if (gameState.gamePhase === 'finished') {
                document.getElementById('lobby').classList.remove('active');
                document.getElementById('gameSection').classList.remove('active');
                document.getElementById('finished').classList.add('active');

                document.getElementById('final-left-score').textContent = gameState.leftTeam.score;
                document.getElementById('final-right-score').textContent = gameState.rightTeam.score;

                const leftScore = gameState.leftTeam.score;
                const rightScore = gameState.rightTeam.score;
                const announce = document.getElementById('winner-announcement');

                if (leftScore > rightScore) {
                    announce.innerHTML = '<div class="winner">üî¥ Left Team Wins! üéâ</div>';
                } else if (rightScore > leftScore) {
                    announce.innerHTML = '<div class="winner">üîµ Right Team Wins! üéâ</div>';
                } else {
                    announce.innerHTML = '<div class="winner">It\'s a Tie! ü§ù</div>';
                }
            }
        }

        async function joinTeam(team) {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('Please enter your name');
                return;
            }

            const response = await fetch('/api/join', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, team })
            });

            currentTeam = team;
            pollState();
        }

        async function startGame() {
            await fetch('/api/start-game', { method: 'POST' });
            pollState();
            pollInterval = setInterval(pollState, 500);
        }

        async function submitQuestion() {
            let question = '';
            if (gameState.gamePhase === 'left-asks') {
                question = document.getElementById('question-input').value.trim();
                if (!question) {
                    alert('Please enter a question');
                    return;
                }
                document.getElementById('question-input').value = '';
            } else if (gameState.gamePhase === 'right-asks') {
                question = document.getElementById('question-input-2').value.trim();
                if (!question) {
                    alert('Please enter a question');
                    return;
                }
                document.getElementById('question-input-2').value = '';
            }

            await fetch('/api/submit-question', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question })
            });

            pollState();
        }

        async function submitAnswer() {
            let answer = '';
            if (gameState.gamePhase === 'right-answers') {
                answer = document.getElementById('answer-input').value.trim();
                if (!answer) {
                    alert('Please enter an answer');
                    return;
                }
                document.getElementById('answer-input').value = '';
            } else if (gameState.gamePhase === 'left-answers') {
                answer = document.getElementById('answer-input-2').value.trim();
                if (!answer) {
                    alert('Please enter an answer');
                    return;
                }
                document.getElementById('answer-input-2').value = '';
            }

            await fetch('/api/submit-answer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ answer })
            });

            pollState();
        }

        async function submitGrade() {
            let score = 0;
            if (gameState.gamePhase === 'right-answers-grading') {
                score = parseInt(document.getElementById('grade-input-1').value) || 0;
            } else if (gameState.gamePhase === 'left-answers-grading') {
                score = parseInt(document.getElementById('grade-input-2').value) || 0;
            }

            if (score < 0 || score > 5) {
                alert('Score must be between 0 and 5');
                return;
            }

            await fetch('/api/submit-grade', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ score })
            });

            pollState();
        }

        async function resetGame() {
            await fetch('/api/reset', { method: 'POST' });
            currentTeam = null;
            document.getElementById('playerName').value = '';
            pollState();
        }

        // Initial load
        pollState();
    </script>
</body>
</html>
